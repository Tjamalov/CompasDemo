# Контекст проекта "Компас"

## Описание
Приложение-компас для Telegram Mini Apps, которое показывает направление к выбранным точкам с использованием пешеходных маршрутов Mapbox API и интерактивной карты.

## Архитектура

### Фронтенд
- **Vue 3** + **TypeScript** - основной фреймворк
- **Vite** - сборщик и dev-сервер
- **Composition API** - для реактивности
- **Vue Router** - маршрутизация

### База данных
- **SQLite** (sql.js) - локальная база данных в браузере
- Таблица `points` с полями: id, coordinates, name, description, createdAt
- Автоматическое сохранение в localStorage

### Внешние API
- **Mapbox Directions API** - построение пешеходных маршрутов
- **Mapbox GL JS** - интерактивные карты
- **Geolocation API** - получение текущего местоположения
- **Telegram Mini Apps SDK** - интеграция с Telegram

## Компоненты

### CompassApp.vue
Основной компонент приложения, управляет состоянием и координирует работу других компонентов.

### CompassArrow.vue
Анимированная стрелка компаса, поворачивается в зависимости от направления к точке.

### MapboxMap.vue
Интерактивная карта Mapbox с отображением пешеходного маршрута между текущим местоположением и выбранной точкой.

### PointSelector.vue
Выпадающий список для выбора точки назначения из базы данных.

### DistanceDisplay.vue
Отображение расстояния до точки и времени в пути.

### LocationStatus.vue
Индикатор статуса геолокации с возможностью повтора запроса.

## Утилиты

### database/sqlite.ts
- Инициализация SQLite базы данных
- CRUD операции с точками
- Сохранение/загрузка из localStorage
- Fallback режим при недоступности SQLite

### utils/geolocation.ts
- Получение текущего местоположения
- Отслеживание изменений позиции
- Вычисление расстояний и направлений

### utils/mapbox.ts
- Интеграция с Mapbox Directions API
- Построение пешеходных маршрутов
- Получение геометрии маршрута для карты
- Форматирование данных

### utils/route.ts
- Вычисление маршрутов с геометрией
- Fallback на прямые направления
- Валидация координат

### utils/telegram.ts
- Инициализация Telegram Mini Apps SDK
- Мок для разработки
- Управление UI элементами Telegram

## Состояние приложения

```typescript
interface CompassState {
  currentLocation: Location | null;
  selectedPoint: Point | null;
  routeData: RouteData | null;
  isLoading: boolean;
  error: string | null;
}
```

## Поток данных

1. Инициализация → загрузка точек из БД
2. Получение геолокации → обновление маршрута
3. Выбор точки → построение маршрута через Mapbox
4. Отображение направления, расстояния и карты с маршрутом

## Особенности реализации

- **Offline-first** - работает без интернета (кроме маршрутизации)
- **Responsive** - адаптивный дизайн для мобильных устройств
- **Real-time** - обновление направления при изменении позиции
- **Error handling** - обработка ошибок геолокации и API
- **Progressive** - постепенная загрузка функций

## Конфигурация

- **Vite** настроен для работы с SQLite и Mapbox
- **TypeScript** с строгими типами
- **ESLint** для качества кода
- **CSS** с использованием современных возможностей

## Развертывание

- Сборка через Vite
- Размещение на HTTPS хостинге
- Настройка Telegram бота через @BotFather
- Указание URL в настройках Mini App

## Настройка Mapbox

Для работы карты необходимо настроить токен Mapbox:

1. Создайте файл `.env` в корне проекта
2. Добавьте: `VITE_MAPBOX_ACCESS_TOKEN=pk.your_token_here`
3. Получите токен на https://account.mapbox.com/access-tokens/

Без токена карта будет показывать только маркеры без маршрутов.
